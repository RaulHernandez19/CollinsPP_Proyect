<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Orrery with Sun-Centered Orbits and Earth at Origin</title>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.87/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        #cesiumContainer {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.87/Build/Cesium/Cesium.js"></script>
    <script>
        // Initialize Cesium Viewer
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyYzJhZjE2NC1mOWQ2LTQ4NTItODRlMC0zZDkyMWMyYWI4ODMiLCJpZCI6MjQ2MTMxLCJpYXQiOjE3MjgxNTM2MTR9.BDbM94S9z_B2W2sq25ib4WgLdYVQgZnYegUTdWEuIes';
        const viewer = new Cesium.Viewer('cesiumContainer', {
            timeline: false,
            animation: false,
            sceneModePicker: false,
            baseLayerPicker: false,
            geocoder: false,
            homeButton: false,
            fullscreenButton: false,
            navigationHelpButton: false,
            skyBox: false,
            skyAtmosphere: false,
            backgroundColor: Cesium.Color.BLACK
        });

        // NASA Planetary Data from API (positions in AU)
        const planetData = {
            "sun": { "x": 0, "y": 0, "z": 0 }, // Sun at origin
            "earth": { "x": 0.9747037759215772, "y": 0.2225969912755935, "z": -0.00001606858767451231 },
            "moon": { "x": 0.969772847365557, "y": 0.2340944772529008, "z": -0.0002090087091702586 },
            "jupiter": { "x": 1.695718817715909, "y": 4.76179136588304, "z": -0.05771889168073751 },
            "mars": { "x": 0.620700255060626, "y": 1.375692985216991, "z": 0.01360445098469851 },
            "mercury": { "x": -0.3818991770447907, "y": -0.1847217615635356, "z": 0.01993302458238139 },
            "neptune": { "x": 29.87523615642745, "y": -0.9092685619071048, "z": -0.6697285953563352 },
            "pluto": { "x": 17.98812408480891, "y": -30.08901308450885, "z": -1.981389640987474 },
            "saturn": { "x": 9.387522028135445, "y": -2.238790675318705, "z": -0.3346953577464323 },
            "uranus": { "x": 11.38684141135065, "y": 15.9133227110374, "z": -0.08854031364522484 },
            "venus": { "x": 0.03633953818810691, "y": -0.7260964761676776, "z": -0.01206884220210594 }
        };

        // Scaling factor for visualization purposes (adjust as needed)
        const scaleFactor = 5e7; // Reduced scaling AU to Cesium coordinates for better visibility

        // Adjusted Planet sizes (radii in kilometers scaled down for visualization)
        const planetRadii = {
            mercury: 1000,
            venus: 2000,
            earth: 2500,
            moon: 700, // Moon radius
            mars: 1500,
            jupiter: 5000,
            saturn: 4500,
            uranus: 3000,
            neptune: 2800,
            pluto: 1000,
            sun: 10000 // Scaled down Sun's radius for a better view
        };

        // Function to validate planet data
        function isPlanetDataValid(planetPosition, planetName) {
            if (!planetPosition || planetPosition.x === undefined || planetPosition.y === undefined || planetPosition.z === undefined) {
                console.error(`Invalid data for ${planetName}:`, planetPosition);
                return false;
            }
            return true;
        }

        // Define Sun's position relative to Earth (assuming Earth is at origin)
        const sunPosition = {
            x: -planetData.earth.x * scaleFactor,
            y: -planetData.earth.y * scaleFactor,
            z: -planetData.earth.z * scaleFactor
        };

        // Add Sun entity
        viewer.entities.add({
            position: new Cesium.Cartesian3(sunPosition.x, sunPosition.y, sunPosition.z),
            ellipsoid: {
                radii: new Cesium.Cartesian3(planetRadii.sun * 1000, planetRadii.sun * 1000, planetRadii.sun * 1000),
                material: Cesium.Color.YELLOW
            },
            label: {
                text: 'Sun',
                font: '14pt sans-serif',
                fillColor: Cesium.Color.WHITE,
                showBackground: true,
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -20)
            }
        });

        // Function to add orbits using PolylineGraphics centered on the Sun
        function createOrbit(planetPosition, planetName) {
            // Calculate relative position to Sun
            const relativePosition = {
                x: (planetPosition.x - planetData.sun.x) * scaleFactor,
                y: (planetPosition.y - planetData.sun.y) * scaleFactor,
                z: (planetPosition.z - planetData.sun.z) * scaleFactor
            };

            const centerPosition = new Cesium.Cartesian3(sunPosition.x, sunPosition.y, sunPosition.z);

            const semiMajorAxis = Cesium.Cartesian3.distance(new Cesium.Cartesian3(0, 0, 0), new Cesium.Cartesian3(relativePosition.x, relativePosition.y, relativePosition.z));
            const semiMinorAxis = semiMajorAxis * 0.98; // Slightly elliptical for realism

            const positions = [];
            const steps = 360; // Number of points in the orbit

            for (let i = 0; i <= steps; i++) {
                const angle = Cesium.Math.toRadians(i);
                const x = semiMajorAxis * Math.cos(angle) + centerPosition.x;
                const y = semiMinorAxis * Math.sin(angle) + centerPosition.y;
                const z = 0 + centerPosition.z; // Assuming orbits lie in the XY plane
                positions.push(new Cesium.Cartesian3(x, y, z));
            }

            // Add polyline to represent the orbit
            viewer.entities.add({
                polyline: {
                    positions: positions,
                    width: 1.5,
                    material: planetName === 'sun' ? Cesium.Color.YELLOW : Cesium.Color.WHITE.withAlpha(0.5),
                    arcType: Cesium.ArcType.NONE
                },
                label: {
                    text: `${planetName.charAt(0).toUpperCase() + planetName.slice(1)} Orbit`,
                    font: '12pt sans-serif',
                    fillColor: Cesium.Color.WHITE,
                    showBackground: true,
                    pixelOffset: new Cesium.Cartesian2(0, -20), // Adjust label position
                    position: positions[Math.floor(steps / 2)]
                }
            });
        }

        // Add planets and orbits to the scene using Sun as the center
        Object.keys(planetData).forEach(planetName => {
            if (planetName === 'sun') {
                // Sun is already added
                return;
            }

            const position = planetData[planetName];
            const radius = planetRadii[planetName] || 3000;  // Default radius if not defined

            // Check if planet position is valid before proceeding
            if (isPlanetDataValid(position, planetName)) {
                // Adjust planet position relative to Earth (which is at origin)
                const relativePosition = {
                    x: (position.x - planetData.earth.x) * scaleFactor,
                    y: (position.y - planetData.earth.y) * scaleFactor,
                    z: (position.z - planetData.earth.z) * scaleFactor
                };

                // Add planet entity
                viewer.entities.add({
                    position: new Cesium.Cartesian3(relativePosition.x, relativePosition.y, relativePosition.z),
                    ellipsoid: {
                        radii: new Cesium.Cartesian3(radius * 1000, radius * 1000, radius * 1000),  // Scale radii for visibility
                        material: Cesium.Color.fromRandom({ alpha: 0.8 }),
                    },
                    label: {
                        text: planetName.charAt(0).toUpperCase() + planetName.slice(1),
                        font: '14pt sans-serif',
                        fillColor: Cesium.Color.WHITE,
                        showBackground: true,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(0, -20)
                    }
                });

                // Create orbit for the planet around the Sun
                createOrbit(position, planetName);
            }
        });

        // Add Earth's orbit around the Sun
        createOrbit(planetData.earth, 'earth');

        // Add Moon as a satellite of Earth
        createOrbit(planetData.moon, 'moon');

        // Add Earth and Moon entities
        viewer.entities.add({
            position: new Cesium.Cartesian3(0, 0, 0),
            ellipsoid: {
                radii: new Cesium.Cartesian3(planetRadii.earth * 1000, planetRadii.earth * 1000, planetRadii.earth * 1000),
                material: Cesium.Color.BLUE,
            },
            label: {
                text: 'Earth',
                font: '14pt sans-serif',
                fillColor: Cesium.Color.WHITE,
                showBackground: true,
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -20)
            }
        });

        // Add Moon entity
        const moonPosition = {
            x: (planetData.moon.x - planetData.earth.x) * scaleFactor,
            y: (planetData.moon.y - planetData.earth.y) * scaleFactor,
            z: (planetData.moon.z - planetData.earth.z) * scaleFactor
        };

        viewer.entities.add({
            position: new Cesium.Cartesian3(moonPosition.x, moonPosition.y, moonPosition.z),
            ellipsoid: {
                radii: new Cesium.Cartesian3(planetRadii.moon * 1000, planetRadii.moon * 1000, planetRadii.moon * 1000),
                material: Cesium.Color.GRAY,
            },
            label: {
                text: 'Moon',
                font: '12pt sans-serif',
                fillColor: Cesium.Color.WHITE,
                showBackground: true,
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -20)
            }
        });

        // Fly camera to Earth’s position (origin)
        viewer.camera.flyTo({
            destination: new Cesium.Cartesian3(0, 0, 5e8), // Adjusted for better view
            orientation: {
                heading: Cesium.Math.toRadians(0.0),
                pitch: Cesium.Math.toRadians(-90.0),
                roll: 0.0
            },
            duration: 2 // seconds
        });
    </script>
</body>
</html>
